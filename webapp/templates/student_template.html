<!DOCTYPE html>
{% load static %}

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Dashboard - InternHub</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet">

  <style>
      .description {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
      }
      .description.expanded {
          -webkit-line-clamp: unset;
      }
      .card-hover:hover {
          transform: translateY(-5px);
          transition: 0.25s ease;
      }

@keyframes scaleIn {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.animate-scaleIn {
  animation: scaleIn 0.25s ease-out;
}


  </style>
</head>

<body class="bg-gray-100">

<!-- NAVBAR -->
<nav class="bg-white shadow-md fixed top-0 left-0 w-full z-50">
  <div class="px-6 py-4 flex justify-between items-center">

    <!-- Mobile Menu Button -->
    <button class="lg:hidden text-2xl">
      <i class="ri-menu-line"></i>
    </button>

    <!-- Logo -->
    <h1 class="text-2xl font-bold text-blue-600">
      InternHUB
    </h1>

    <!-- Right Section -->
    <div class="flex items-center gap-6">

      <!-- Welcome Text -->
      <span class="hidden sm:block text-gray-700 text-sm">
        Welcome,
        <span class="font-semibold text-blue-600">
          {{ student.name }}
        </span>
      </span>

      <!-- Notifications -->
      <a href="{% url 'student_notifications' %}" class="relative">
  <i class="ri-notification-3-fill text-2xl text-gray-700"></i>

  {% if unread_notification_count > 0 %}
  <span
    class="absolute -top-1 -right-1 bg-red-600 text-white text-xs
           w-5 h-5 flex items-center justify-center rounded-full">
    {{ unread_notification_count }}
  </span>
  {% endif %}
</a>




      <!-- Profile Dropdown -->
      <div class="relative">
        {% if student.img %}
        <img src="{{ student.img.url }}"
             onclick="toggleProfileMenu()"
             class="w-10 h-10 rounded-full border cursor-pointer object-cover">
        {% else %}
        <img src="{% static 'images/default_user.png' }}"
             onclick="toggleProfileMenu()"
             class="w-10 h-10 rounded-full border cursor-pointer">
        {% endif %}

        <div id="profileMenu"
     class="hidden absolute right-0 mt-2 w-44 bg-white shadow-xl rounded-xl z-50 border">
  <a href="{% url 'student_settings' %}"
     class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100">
    <i class="ri-user-line"></i> Profile
  </a>

  <a href="{% url 'login_select' %}"
     class="flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50">
    <i class="ri-logout-box-r-line"></i> Logout
  </a>
</div>

      </div>

    </div>
  </div>
</nav>


<!-- MAIN LAYOUT -->
<div class="flex pt-24 px-6">


  <!-- SIDEBAR -->
   <aside class="fixed top-24 left-6 w-72 h-[calc(100vh-6rem)]
               bg-white rounded-xl shadow-xl p-6
               hidden lg:block overflow-y-auto">

    <div class="flex flex-col items-center text-center">
      {% if student.img %}
      <img src="{{ student.img.url }}"
           class="w-28 h-28 rounded-full object-cover border-4 border-blue-600 shadow">
      {% else %}
      <img src="{% static 'images/default_user.png' %}"
           class="w-28 h-28 rounded-full border-4 border-blue-600 shadow">
      {% endif %}

      <h2 class="text-xl font-bold mt-3">{{ student.name }}</h2>
      <p class="text-gray-500 text-sm">Student</p>
    </div>

    <hr class="my-5">

    <nav class="space-y-3 text-gray-700">


        <!-- ACTIVE -->
      <a href="{% url 'student_page' %}"
         class="flex items-center gap-3 p-2 rounded bg-blue-100 text-blue-700 font-semibold">
        <i class="ri-settings-3-line text-xl"></i> Dashboard
      </a>

      <a href="{% url 'my_applications' %}"
         class="flex items-center gap-3 p-2 rounded hover:bg-gray-200">
        <i class="ri-file-list-3-line text-xl"></i> My Applications
      </a>

      <a href="{% url 'saved_internships' %}"
         class="flex items-center gap-3 p-2 rounded hover:bg-gray-200">
        <i class="ri-heart-fill text-xl text-red-500"></i> Saved Internships
      </a>


    <a href="{% url 'student_settings' %}"
         class="flex items-center gap-3 p-2 rounded hover:bg-gray-200">
        <i class="ri-settings-3-line text-xl"></i> Settings
      </a>
    </nav>
  </aside>

  <!-- MAIN FEED -->
  <main class="flex-1 ml-[18.5rem]">
      {% if messages %}
<div id="popupMessage"
     class="fixed inset-0 flex items-center justify-center bg-black/40 z-50">

  <div class="bg-white w-[360px] p-6 rounded-2xl shadow-2xl
              text-center animate-scaleIn">

    {% for message in messages %}

      <!-- ICON -->
      {% if message.tags == 'success' %}
        <div class="text-green-500 text-5xl mb-3">
          <i class="ri-checkbox-circle-fill"></i>
        </div>
      {% elif message.tags == 'error' %}
        <div class="text-red-500 text-5xl mb-3">
          <i class="ri-close-circle-fill"></i>
        </div>
      {% elif message.tags == 'warning' %}
        <div class="text-yellow-500 text-5xl mb-3">
          <i class="ri-error-warning-fill"></i>
        </div>
      {% else %}
        <div class="text-blue-500 text-5xl mb-3">
          <i class="ri-information-fill"></i>
        </div>
      {% endif %}

      <!-- MESSAGE TEXT -->
      <p class="text-gray-700 font-medium mb-4">
        {{ message }}
      </p>

    {% endfor %}

    <!-- OK BUTTON -->
    <button onclick="closePopupMsg()"
            class="mt-2 bg-blue-600 hover:bg-blue-700
                   text-white px-6 py-2 rounded-xl">
      OK
    </button>
  </div>
</div>
{% endif %}




    <h2 class="text-2xl font-bold mb-6">Latest Internships</h2>

    {% for i in internships %}
    <div class="bg-white p-6 rounded-xl shadow card-hover mb-6">
        {% if i.company %}
<a href="{% url 'rate_company' i.company.id %}"
   class="text-sm text-yellow-600 hover:underline font-semibold">
   ‚≠ê Rate {{ i.company.company_name }}
</a>
{% endif %}


      <!-- HEADER -->
      <div class="flex items-center gap-4">
        {% if i.logo %}
          <img src="{{ i.logo.url }}" class="w-20 h-20 rounded-full object-cover mb-4">
        {% endif %}

        <div>
          <h3 class="text-xl font-bold">{{ i.internship_title }}</h3>
          <p class="text-gray-500">{{ i.company_name }} ‚Ä¢ {{ i.location }}</p>
        </div>
      </div>

      <!-- DESCRIPTION -->
      <p id="desc{{ i.id }}" class="description mt-4 text-gray-700">
        {{ i.description }}
      </p>

      <button onclick="toggleDesc('desc{{ i.id }}', this)"
              class="text-blue-600 mt-1 hover:underline">
        Read more
      </button>

      <!-- POST IMAGE -->
      {% if i.image %}
        <img src="{{ i.image.url }}" class="w-full max-h-[450px] object-contain rounded-xl mt-3 shadow bg-black/5 p-2">
      {% endif %}

      <!-- ACTIONS -->
      <div class="flex justify-between items-center mt-6">

        <!-- APPLY BUTTON -->
        <form id="applyForm{{ i.id }}" action="{% url 'apply_internship' i.id %}" method="POST">
            {% csrf_token %}

            {% if i.id in applied_ids %}
                <button
                    class="bg-gray-400 text-white py-2 px-6 rounded-xl cursor-not-allowed" disabled>
                    <i class="ri-check-line"></i> Applied
                </button>
            {% else %}
                <button
                    type="button"
                    onclick="confirmApply({{ i.id }})"
                    class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-xl">
                    <i class="ri-send-plane-fill"></i> Apply
                </button>

            {% endif %}
        </form>

        {% if i.id in saved_ids %}
<button class="border px-4 py-2 rounded-xl bg-yellow-300 cursor-not-allowed">
  <i class="ri-bookmark-fill"></i> Saved
</button>
{% else %}
<a href="{% url 'save_internship' i.id %}">
  <button class="border px-4 py-2 rounded-xl hover:bg-gray-100">
    <i class="ri-bookmark-line"></i> Save
  </button>
</a>
{% endif %}



      </div>



    </div>

    {% endfor %}

  </main>
</div>

<!-- APPLY CONFIRMATION POPUP -->
<div id="applyPopup" class="fixed inset-0 bg-black/50 hidden justify-center items-center">
    <div class="bg-white p-6 rounded-xl w-[350px] shadow-xl text-center">
        <h2 class="text-xl font-bold text-gray-800">Confirm Apply</h2>
        <p class="text-gray-600 mt-2">Are you sure you want to apply?</p>

        <div class="flex justify-center gap-4 mt-5">
            <button onclick="closePopup()"
                    class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
                Cancel
            </button>
            <button id="confirmBtn"
                    class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Apply
            </button>
        </div>
    </div>
</div>


<!-- Chatbot Floating Button -->
<div id="chatbot-btn"
     class="fixed bottom-6 right-6 bg-green-500 text-white w-14 h-14
            rounded-full flex items-center justify-center cursor-pointer
            shadow-lg hover:bg-green-600 transition">
    üí¨
</div>

<!-- Chatbot Window -->
<!-- Chatbot Window -->
<div id="chatbot-box"
     class="fixed bottom-24 right-6 w-80 bg-white rounded-xl shadow-xl
            hidden flex flex-col border z-50">

    <!-- Header -->
    <div class="bg-green-500 text-white p-3 rounded-t-xl font-semibold flex justify-between">
        <span>InternHub Assistant</span>
        <button onclick="toggleChatbot()">‚úñ</button>
    </div>

    <!-- Messages -->
    <div id="chat-messages"
         class="flex-1 p-3 overflow-y-auto text-sm space-y-2">

        <!-- Bot Welcome -->
        <div class="bg-gray-100 p-2 rounded">
            üëã Hi! I‚Äôm your InternHub Assistant.<br>
            Ask me about internships, applications, resume, or status.
        </div>

        <!-- Quick Buttons -->
        <div class="flex flex-wrap gap-2">
            <button onclick="sendQuick('How to apply?')"
                    class="text-xs bg-blue-100 px-2 py-1 rounded">Apply</button>

            <button onclick="sendQuick('Application status')"
                    class="text-xs bg-blue-100 px-2 py-1 rounded">Status</button>

            <button onclick="sendQuick('Resume upload')"
                    class="text-xs bg-blue-100 px-2 py-1 rounded">Resume</button>

            <button onclick="sendQuick('Saved internships')"
                    class="text-xs bg-blue-100 px-2 py-1 rounded">Saved</button>
        </div>
    </div>

    <!-- Input -->
    <div class="p-2 border-t flex gap-2">
        <input id="chat-input"
               type="text"
               placeholder="Type a message..."
               class="flex-1 border rounded px-2 py-1 text-sm">

        <button onclick="sendMessage()"
                class="bg-green-500 text-white px-3 rounded">
            Send
        </button>
    </div>
</div>


<script>
let selectedForm = null;

function confirmApply(id) {
    selectedForm = document.getElementById("applyForm" + id);
    document.getElementById("applyPopup").classList.remove("hidden");
    document.getElementById("applyPopup").classList.add("flex");
}

function closePopup() {
    document.getElementById("applyPopup").classList.add("hidden");
}

document.getElementById("confirmBtn").addEventListener("click", function () {
    if (selectedForm) {
        selectedForm.submit();
    }
});

function toggleDesc(id, btn) {
    const box = document.getElementById(id);
    box.classList.toggle("expanded");
    btn.textContent = box.classList.contains("expanded") ? "Show less" : "Read more";
}


function confirmApply(internshipId) {
    if (confirm("Do you want to apply for this internship?")) {
        window.location.href =
            "{% url 'confirm_apply' 0 %}".replace('0', internshipId);
    }
}



const chatbotBtn = document.getElementById("chatbot-btn");
const chatbotBox = document.getElementById("chatbot-box");
const chatMessages = document.getElementById("chat-messages");
const chatInput = document.getElementById("chat-input");

/* OPEN / CLOSE CHATBOT */
chatbotBtn.onclick = toggleChatbot;

function toggleChatbot() {
    chatbotBox.classList.toggle("hidden");
}

/* SEND QUICK MESSAGE */
function sendQuick(text) {
    chatInput.value = text;
    sendMessage();
}

/* SEND MESSAGE */
function sendMessage() {
    const msg = chatInput.value.trim();
    if (!msg) return;

    // User message
    chatMessages.innerHTML += `
        <div class="text-right">
            <div class="inline-block bg-green-500 text-white p-2 rounded">
                ${msg}
            </div>
        </div>
    `;

    chatInput.value = "";
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Bot reply delay
    setTimeout(() => {
        chatMessages.innerHTML += `
            <div class="bg-gray-100 p-2 rounded">
                ${getBotReply(msg)}
            </div>
        `;
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 600);
}

/* CHATBOT LOGIC */
function getBotReply(message) {
    message = message.toLowerCase();

    if (message.includes("hi") || message.includes("hello")) {
        return "üëã Hello! I can help you with internships, applications, resume, and more.";
    }

    if (message.includes("apply")) {
        return "üìå Click the **Apply** button on an internship card to apply. You can apply only once.";
    }

    if (message.includes("status") || message.includes("application")) {
        return "üìÑ Go to **My Applications** to check your application status like Applied, Selected, or Rejected.";
    }

    if (message.includes("save")) {
        return "‚≠ê Use the **Save** button to bookmark internships. View them in **Saved Internships**.";
    }

    if (message.includes("resume") || message.includes("cv")) {
        return "üìÑ Upload or update your resume from **Profile ‚Üí Settings**.";
    }

    if (message.includes("internship")) {
        return "üíº Browse internships on your dashboard. Click any post to see full details.";
    }

    if (message.includes("eligibility")) {
        return "‚úÖ Eligibility criteria are mentioned in the internship description.";
    }

    if (message.includes("company")) {
        return "üè¢ You can view company details and also rate companies after applying.";
    }

    if (message.includes("rating") || message.includes("review")) {
        return "‚≠ê Company ratings help other students. You can rate a company after application.";
    }

    if (message.includes("notification")) {
        return "üîî Notifications alert you about application updates and important messages.";
    }

    if (message.includes("logout")) {
        return "üö™ Logout using **Profile ‚Üí Logout** from the top-right corner.";
    }

    if (message.includes("help")) {
        return `
ü§ñ I can help you with:
‚Ä¢ Applying internships
‚Ä¢ Application status
‚Ä¢ Resume upload
‚Ä¢ Saved internships
‚Ä¢ Company ratings
        `;
    }

    return "‚ùì Sorry, I didn‚Äôt understand. Try asking about **apply, status, resume, saved, or internships**.";
}


function toggleNotification() {
  document.getElementById("notificationBox").classList.toggle("hidden");
}
/* PROFILE DROPDOWN TOGGLE */
function toggleProfileMenu() {
    const menu = document.getElementById("profileMenu");
    menu.classList.toggle("hidden");
}

/* CLOSE DROPDOWN WHEN CLICKING OUTSIDE */
document.addEventListener("click", function (event) {
    const profileMenu = document.getElementById("profileMenu");
    const profileImage = event.target.closest("img");

    if (!profileMenu || profileMenu.classList.contains("hidden")) return;

    if (!profileMenu.contains(event.target) && !profileImage) {
        profileMenu.classList.add("hidden");
    }
});
setTimeout(() => {
    const alerts = document.querySelectorAll(".bg-green-100");
    alerts.forEach(alert => alert.remove());
  }, 3000); // 3 seconds

function closePopupMsg() {
  const popup = document.getElementById("popupMessage");
  if (popup) {
    popup.classList.add("hidden");
    popup.remove();
  }
}

// Auto close after 3 seconds
setTimeout(closePopupMsg, 3000);



</script>

</body>
</html>
